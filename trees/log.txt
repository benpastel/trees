TREE_COUNT=10


Agaricus:

X.shape: train (5211, 126), valid (1302, 126)
binary classification with 2523 true and 2688 false
train xgboost with: {'n_estimators': 10, 'tree_method': 'hist'}...
(0.1s)
predict xgboost...
(0.0s)

      train preds bincount: [2688 2523]
      train: accuracy = 100.00%, precision = 100.00%, recall = 100.00%
      valid: accuracy = 100.00%, precision = 100.00%, recall = 100.00%

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=10, learning_rate=0.3)...
(0.1s)
Classification model with 10 trees with sizes min=22 max=40 mean=29.5
predict our tree...
(0.0s)

      train preds bincount: [2688 2523]
      train: accuracy = 100.00%, precision = 100.00%, recall = 100.00%
      valid: accuracy = 100.00%, precision = 100.00%, recall = 100.00%



House Prices:

X.shape: train (1168, 79), valid (292, 79)
regression targets with min=34900.0, max=755000.0, mean=181039.6
train xgboost with: {'n_estimators': 10, 'tree_method': 'hist'}...
(0.1s)
predict xgboost...
(0.0s)

      train preds: min=46273.2, max=662945.9, mean=175110.5
      train: log(MSE): 19.1, MAE: 10130.5
      valid: log(MSE): 20.6, MAE: 18888.8

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=10, learning_rate=0.3)...
(0.0s)
Regression model with 10 trees with sizes min=4 max=7 mean=5.5
predict our tree...
(0.0s)

      train preds: min=100960.5, max=586792.5, mean=181039.6
      train: log(MSE): 20.6, MAE: 20763.4
      valid: log(MSE): 20.9, MAE: 22849.8



Home Credit Default:

X.shape: train (246009, 104), valid (61502, 104)
binary classification with 19836 true and 226173 false
train xgboost with: {'n_estimators': 10, 'tree_method': 'hist'}...
(1.3s)
predict xgboost...
(0.5s)

      train preds bincount: [245948     61]
      train: accuracy = 91.95%, precision = 78.69%, recall = 0.24%
      valid: accuracy = 91.90%, precision = 63.64%, recall = 0.28%

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=10, learning_rate=0.3)...
(1.9s)
Classification model with 10 trees with sizes min=10 max=52 mean=30.4
predict our tree...
(0.1s)

      train preds bincount: [245965     44]
      train: accuracy = 91.95%, precision = 79.55%, recall = 0.18%
      valid: accuracy = 91.90%, precision = 78.57%, recall = 0.22%



Santander Value:

X.shape: train (3568, 4991), valid (891, 4991)
regression targets with min=30000.0, max=40000000.0, mean=5977043.8
train xgboost with: {'n_estimators': 10, 'tree_method': 'hist'}...
(2.1s)
predict xgboost...
(0.3s)

      train preds: min=596577.8, max=35541016.0, mean=5766198.0
      train: log(MSE): 31.1, MAE: 3990920.3
      valid: log(MSE): 31.6, MAE: 4962438.5

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=10, learning_rate=0.3)...
(1.2s)
Regression model with 10 trees with sizes min=1 max=7 mean=3.1
predict our tree...
(0.0s)

      train preds: min=4311095.9, max=25326518.1, mean=5977043.8
      train: log(MSE): 31.6, MAE: 5337766.5
      valid: log(MSE): 31.6, MAE: 5246239.1



M5:

loading from cache
X.shape: train (37734424, 19), valid (9433606, 19)
regression targets with min=0.0, max=763.0, mean=1.2
train xgboost with: {'n_estimators': 10, 'tree_method': 'hist'}...
(36.4s)
predict xgboost...
(14.2s)

      train preds: min=0.0, max=622.1, mean=1.2
      train: MSE: 4.6, MAE: 0.8
      valid: MSE: 4.7, MAE: 0.8

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=10, learning_rate=0.3)...
(34.5s)
Regression model with 10 trees with sizes min=3280 max=3280 mean=3280.0
predict our tree...
(3.9s)

      train preds: min=-8.0, max=697.9, mean=1.2
      train: MSE: 3.7, MAE: 0.8
      valid: MSE: 4.6, MAE: 0.8



Grupo:

loading from cache
X.shape: train (33112214, 75), valid (8278053, 75)
regression targets with min=0.0, max=5000.0, mean=7.3
train xgboost with: {'n_estimators': 10, 'tree_method': 'hist'}...
(133.2s)
predict xgboost...
(44.0s)

      train preds: min=-32.8, max=4063.0, mean=7.1
      train: MSE: 178.8, MAE: 3.9
      valid: MSE: 186.5, MAE: 3.9

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=10, learning_rate=0.3)...
(99.8s)
Regression model with 10 trees with sizes min=3280 max=3280 mean=3280.0
predict our tree...
(4.9s)

      train preds: min=-32.6, max=4777.0, mean=7.3
      train: MSE: 100.2, MAE: 3.5
      valid: MSE: 156.0, MAE: 3.6

rm trees/c/tree.cpython-38-darwin.so # TODO make properly
cd trees/c && python setup.py build_ext --inplace
running build_ext
building 'tree' extension
clang -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -I/usr/local/lib -I/usr/local/lib/python3.8/site-packages/numpy/core/include/numpy/ -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/usr/local/opt/python@3.8/Frameworks/Python.framework/Versions/3.8/include/python3.8 -c tree.c -o build/temp.macosx-10.15-x86_64-3.8/tree.o -fopenmp -ffast-math
clang -bundle -undefined dynamic_lookup -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk build/temp.macosx-10.15-x86_64-3.8/tree.o -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -o /Users/benji/dev/trees/trees/c/tree.cpython-38-darwin.so -lomp
python -m pytest
====================================================================== test session starts =======================================================================
platform darwin -- Python 3.8.2, pytest-5.3.5, py-1.8.1, pluggy-0.13.1
rootdir: /Users/benji/dev/trees
collected 5 items

test/test_binning.py ..                                                                                                                                    [ 40%]
test/test_model.py .                                                                                                                                       [ 60%]
test/test_trees.py ..                                                                                                                                      [100%]

======================================================================= 5 passed in 0.87s ========================================================================
python -m trees.benchmarks


TREE_COUNT=100


Agaricus:

X.shape: train (5211, 126), valid (1302, 126)
binary classification with 2510 true and 2701 false
train xgboost with: {'n_estimators': 100, 'tree_method': 'hist'}...
(0.2s)
predict xgboost...
(0.0s)

      train preds bincount: [2701 2510]
      train: accuracy = 100.00%, precision = 100.00%, recall = 100.00%
      valid: accuracy = 100.00%, precision = 100.00%, recall = 100.00%

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=100, learning_rate=0.3)...
(0.3s)
Classification model with 100 trees with sizes min=1 max=46 mean=8.74
predict our tree...
(0.0s)

      train preds bincount: [2701 2510]
      train: accuracy = 100.00%, precision = 100.00%, recall = 100.00%
      valid: accuracy = 100.00%, precision = 100.00%, recall = 100.00%



House Prices:

X.shape: train (1168, 79), valid (292, 79)
regression targets with min=34900.0, max=755000.0, mean=179550.7
train xgboost with: {'n_estimators': 100, 'tree_method': 'hist'}...
(0.1s)
predict xgboost...
(0.0s)

      train preds: min=34868.8, max=754869.3, mean=179548.3
      train: log(MSE): 13.9, MAE: 748.1
      valid: log(MSE): 21.3, MAE: 20659.9

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=100, learning_rate=0.3)...
(0.2s)
Regression model with 100 trees with sizes min=1 max=7 mean=1.51
predict our tree...
(0.0s)

      train preds: min=89082.3, max=555555.8, mean=179550.7
      train: log(MSE): 20.4, MAE: 18658.5
      valid: log(MSE): 21.2, MAE: 23694.7



Home Credit Default:

X.shape: train (246009, 104), valid (61502, 104)
binary classification with 19905 true and 226104 false
train xgboost with: {'n_estimators': 100, 'tree_method': 'hist'}...
(2.6s)
predict xgboost...
(0.5s)

      train preds bincount: [244636   1373]
      train: accuracy = 92.24%, precision = 79.83%, recall = 5.51%
      valid: accuracy = 92.00%, precision = 49.41%, recall = 2.54%

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=100, learning_rate=0.3)...
(3.0s)
Classification model with 100 trees with sizes min=1 max=61 mean=4.42
predict our tree...
(0.1s)

      train preds bincount: [245900    109]
      train: accuracy = 91.92%, precision = 67.89%, recall = 0.37%
      valid: accuracy = 92.02%, precision = 66.67%, recall = 0.41%



Santander Value:

X.shape: train (3568, 4991), valid (891, 4991)
regression targets with min=30000.0, max=40000000.0, mean=5993935.5
train xgboost with: {'n_estimators': 100, 'tree_method': 'hist'}...
(7.2s)
predict xgboost...
(0.3s)

      train preds: min=-2275212.8, max=40107108.0, mean=5986508.5
      train: log(MSE): 30.1, MAE: 2392533.2
      valid: log(MSE): 31.6, MAE: 5000309.4

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=100, learning_rate=0.3)...
(5.3s)
Regression model with 100 trees with sizes min=1 max=7 mean=1.24
predict our tree...
(0.0s)

      train preds: min=3665509.9, max=26116739.5, mean=5993935.5
      train: log(MSE): 31.6, MAE: 5397023.8
      valid: log(MSE): 31.6, MAE: 5247766.4



M5:

loading from cache
X.shape: train (37734424, 19), valid (9433606, 19)
regression targets with min=0.0, max=763.0, mean=1.2
train xgboost with: {'n_estimators': 100, 'tree_method': 'hist'}...
(106.4s)
predict xgboost...
(29.5s)

      train preds: min=-7.3, max=750.4, mean=1.2
      train: MSE: 4.4, MAE: 0.8
      valid: MSE: 4.5, MAE: 0.8

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=100, learning_rate=0.3)...
(181.4s)
Regression model with 100 trees with sizes min=1 max=3280 mean=1238.62
predict our tree...
(19.7s)

      train preds: min=-10.7, max=739.3, mean=1.2
      train: MSE: 3.1, MAE: 0.8
      valid: MSE: 4.6, MAE: 0.8



Grupo:

loading from cache
X.shape: train (33112214, 75), valid (8278053, 75)
regression targets with min=0.0, max=5000.0, mean=7.3
train xgboost with: {'n_estimators': 100, 'tree_method': 'hist'}...
(234.5s)
predict xgboost...
(53.1s)

      train preds: min=-103.0, max=4505.3, mean=7.3
      train: MSE: 133.8, MAE: 3.7
      valid: MSE: 166.7, MAE: 3.7

train our tree with Params(smooth_factor=100.0, max_nodes=3280, max_depth=8, tree_count=100, learning_rate=0.3)...
(674.1s)
Regression model with 100 trees with sizes min=1 max=3280 mean=2498.56
predict our tree...
(50.4s)

      train preds: min=-103.5, max=4978.3, mean=7.3
      train: MSE: 48.0, MAE: 3.2
      valid: MSE: 151.7, MAE: 3.4